@using AdminServices.System;
@using AdminModels.Entities;

@{
    Layout = null;

    var menuService = DependencyResolver.Current.GetService<IMenuService>();
    var menus = menuService.Select().ToList();
    var defaultActive = menus.FirstOrDefault(x => Request.Path.StartsWith(x.Url) && !string.IsNullOrWhiteSpace(x.Url))?.Id;
}

@helper CreateMenu(T_Menu menu, List<T_Menu> menus)
{//生成菜单
    var childMenus = menus.Where(x => x.ParentId == menu.Id);
    foreach (var itemMenu in childMenus.OrderBy(x => x.Order))
    {
        if (menus.Any(x => x.ParentId == itemMenu.Id))
        {
            <el-submenu index="@itemMenu.Id">
                <template solt="title">
                    @if (!string.IsNullOrWhiteSpace(itemMenu.Icon))
                    {
                        <i class="@itemMenu.Icon"></i>}
                    @itemMenu.Title
                </template>
                @CreateMenu(itemMenu, menus)
            </el-submenu>
        }
        else
        {
            <el-menu-item index="@itemMenu.Id" @@click="_menuClick('@itemMenu.Url','@itemMenu.Id')">
                @if (!string.IsNullOrWhiteSpace(itemMenu.Icon))
                {<i class="@itemMenu.Icon"></i>}
                @itemMenu.Title
            </el-menu-item>
        }

    }
    if (childMenus.Count() == 0)
    {
        <el-menu-item index="@menu.Id" @@click="_menuClick('@menu.Url','@menu.Id')">
            <i class="@menu.Icon"></i>
            @menu.Title
        </el-menu-item>
    }
}

<el-menu :default-openeds="['1']" :default-active="'@defaultActive'" :router="false" :unique-opened="true">
    @foreach (var menu in menus.Where(x => x.ParentId == null).OrderBy(x => x.Order))
    {
        <el-submenu index="@menu.Id">
            <template slot="title">
                @if (!string.IsNullOrWhiteSpace(menu.Icon))
                {
                    <i class="@menu.Icon"></i>
                }
                @menu.Title
            </template>
            @CreateMenu(menu, menus)
        </el-submenu>
    }
    <el-submenu index="22">
        <template slot="title">
            <i class=""></i>
            测试的
        </template>
        <el-menu-item index="/System/Abc" @@click="_menuClick('/System/Abc')">
            Go to /System/Abc
        </el-menu-item>
        <el-menu-item index="/bar" @@click="_menuClick('ddd')">
            Go to Bar
        </el-menu-item>
    </el-submenu>
</el-menu>